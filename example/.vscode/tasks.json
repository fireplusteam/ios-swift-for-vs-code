{
    // See https://go.microsoft.com/fwlink/?LinkId=733558
    // for the documentation about the tasks.json format
    "version": "2.0.0",
    "options": {
        "env": {
            "envFile": ".vscode/.env"
        }
    },
    "tasks": [
        {
            "label": "iOS: Build Selected Target",
            "type": "shell",
            "command": "${workspaceFolder}/.vscode/build_app.sh",
            "group": {
                "kind": "build",
                "isDefault": false
            },
            "args": ["TARGET"],
            "presentation": {
                "clear": true
            },
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "dependsOn":["Validate Enviroment"]
        },
        {
            "label": "iOS: Build ALL",
            "type": "shell",
            "command": "${workspaceFolder}/.vscode/build_app.sh",
            "group": {
                "kind": "build",
                "isDefault": false
            },
            "args": ["ALL"],
            "presentation": {
                "clear": true
            },
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "dependsOn":["Validate Enviroment"]
        },
        {
            "label": "iOS: Build Tests",
            "type": "shell",
            "command": "${workspaceFolder}/.vscode/build_app.sh",
            "group": {
                "kind": "build",
                "isDefault": false
            },
            "args": ["TESTING"],
            "presentation": {
                "clear": true
            },
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "dependsOn":["Validate Enviroment"]
        },
        {
            "label": "Run iOS App",
            "type": "shell",
            "command": "${workspaceFolder}/.vscode/run_app.sh",
            "args": ["RUNNING"],
            "presentation": {
                "clear": true
            },
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "dependsOn":["Terminate Current iOS App", "Validate Enviroment", "Start Show Logs"],
            "dependsOrder": "sequence"
        },
        {
            "label": "Run & Debug iOS App",
            "type": "shell",
            "command": "${workspaceFolder}/.vscode/run_app.sh",
            "args": ["LLDB_DEBUG"],
            "presentation": {
                "clear": true
            },
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "dependsOn":["Terminate Current iOS App", "Sleep", "Validate Enviroment", "Start LLDB Debugger iOS App", "Start Show Logs"],
            "dependsOrder": "sequence"
        },
        { // needed to give a chance to vs code to update it's state
            "label": "Sleep", 
            "type": "shell",
            "command": "sleep 1"
        },
        {
            "label": "Terminate Current iOS App",
            "type": "shell",
            "command": "${workspaceFolder}/.vscode/terminate_current_running_app.sh"
        },
        {
            "label": "Start Show Logs",
            "command": "${command:launches.showIOSDebugLogs}",
            "group": "none"
        },
        {
            "label": "Start LLDB Debugger iOS App",
            "type": "shell",
            "command": "${command:launches.startIOSDebuging}",
            "dependsOrder": "sequence",
        },
        {
            "label": "Restart Debug iOS App",
            "type": "shell",
            "command": "${command:launches.startIOSDebuging}",
            "args": ["restart"],
            "group": "none"
        },
        {
            "label": "Test iOS App",
            "type": "shell",
            "command": "${workspaceFolder}/.vscode/test_app.sh",
            "group": {
                "kind": "test",
                "isDefault": false,
                "isTestCommand": true
            },
            "presentation": {
                "clear": true
            },
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "dependsOn":["Validate Enviroment"]
        },
        {
            "label": "Generate xCode Server",
            "type": "shell",
            "command": "${workspaceFolder}/.vscode/build_autocomplete.sh",
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "dependsOn":["Validate Enviroment"]
        },
        {
            "label": "Bind Autocomplete",
            "type": "shell",
            "command": ".vscode/restart_lsp_swift.sh",
            "dependsOn": [
                "Generate xCode Server"
            ]
        },
        {
            "label": "Select Destination Device",
            "type": "shell",
            "command": ".vscode/update_enviroment.sh",
            "args": [
                "-destinationDevice",
                "${input:myDestinationDevice}"
            ],
            "problemMatcher": [], 
            "dependsOn":["Validate Enviroment"],
            "group": "none"
        },
        {
            "label": "Select Scheme",
            "type": "shell",
            "command": ".vscode/update_enviroment.sh",
            "args": [
                "-destinationScheme",
                "${input:myDestinationScheme}"
            ],
            "problemMatcher": [],
            "dependsOn":["Validate Enviroment"],
            "runOptions": {"runOn": "folderOpen"},
            "group": "none"
        },
        {
            "label": "Validate Enviroment",
            "type": "shell",
            "command": ".vscode/check_workspace.sh",
            "group": "none"
        }
    ],
    "inputs": [
        {
            "id": "myDestinationDevice",
            "type": "command",
            // first try to read from the disk or select again
            "command": "dynamic-inputs.read",
            "args": {
                "command": "bash",
                // a script which prints JSON array to stdout as the last line
                "args": [
                    "${workspaceFolder}/.vscode/populate_devices.sh"
                ],
                "envFile": "${workspaceFolder}/.vscode/.env",
                "cwd": "${workspaceFolder}",
                // memoize the selection for the future
                "var": "myDestinationDevice",
                // map options to values
                "unwrap": "$[*].value",
                "serializer": "plain",
                "quickPickOptions": {
                    "canPickMany": true, // should be false, but it's not working for some reason
                    //"ignoreFocusOut": true,
                    "placeHolder": "Please select Device",
                    "title": "Device"
                }
            }
        },
        {
            "id": "myDestinationScheme",
            "type": "command",
            // first try to read from the disk or select again
            "command": "dynamic-inputs.read",
            "args": {
                "command": "bash",
                // a script which prints JSON array to stdout as the last line
                "args": [
                    "${workspaceFolder}/.vscode/populate_schemes.sh"
                ],
                "envFile": "${workspaceFolder}/.vscode/.env",
                "cwd": "${workspaceFolder}",
                // memoize the selection for the future
                "var": "myDestinationScheme",
                // map options to values
                "unwrap": "$[*].value",
                "serializer": "plain",
                "quickPickOptions": {
                    "canPickMany": true, // should be false, but it's not working for some reason
                    //"ignoreFocusOut": true,
                    "placeHolder": "Please select Scheme",
                    "title": "Scheme"
                }
            }
        }
    ]
}