{
    // See https://go.microsoft.com/fwlink/?LinkId=733558
    // for the documentation about the tasks.json format
    "version": "2.0.0",
    "options": {
        "env": {
            "envFile": ".vscode/.env"
        }
    },
    "tasks": [
        {
            "label": "iOS: Build Selected Target",
            "type": "shell",
            "command": "${workspaceFolder}/.vscode/build_app.sh",
            "group": {
                "kind": "build",
                "isDefault": false
            },
            "args": ["TARGET"],
            "presentation": {
                "clear": true
            },
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "dependsOn":["iOS: Validate Enviroment"]
        },
        {
            "label": "iOS: Build ALL",
            "type": "shell",
            "command": "${workspaceFolder}/.vscode/build_app.sh",
            "group": {
                "kind": "build",
                "isDefault": false
            },
            "args": ["ALL"],
            "presentation": {
                "clear": true
            },
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "dependsOn":["iOS: Validate Enviroment"]
        },
        {
            "label": "iOS: Build Tests",
            "type": "shell",
            "command": "${workspaceFolder}/.vscode/build_app.sh",
            "group": {
                "kind": "build",
                "isDefault": false
            },
            "args": ["TESTING"],
            "presentation": {
                "clear": true
            },
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "dependsOn":["iOS: Validate Enviroment"],
            "dependsOrder": "sequence"
        },
        {
            "label": "iOS: Build Tests: Current File",
            "type": "shell",
            "command": "${workspaceFolder}/.vscode/build_app.sh",
            "group": {
                "kind": "build",
                "isDefault": false
            },
            "args": [
                "TESTING_ONLY_TESTS",
                "${input:myTestsOfCurrentFile}"
            ],
            "presentation": {
                "clear": true
            },
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "dependsOn":["Store VS Config", "iOS: Validate Enviroment"],
            "dependsOrder": "sequence"
        },
        {
            "label": "Run iOS App",
            "type": "shell",
            "command": "${workspaceFolder}/.vscode/run_app.sh",
            "args": ["RUNNING"],
            "presentation": {
                "clear": true
            },
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "dependsOn":["iOS: Terminate Current iOS App", "iOS: Build Selected Target", "Start Show Logs"],
            "dependsOrder": "sequence"
        },
        {
            "label": "Run & Debug iOS App",
            "type": "shell",
            "command": "${workspaceFolder}/.vscode/run_app.sh",
            "args": ["LLDB_DEBUG"],
            "presentation": {
                "clear": true
            },
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "dependsOn":["iOS: Terminate Current iOS App", "iOS: Build Selected Target", "iOS: Start LLDB Debugger iOS App", "Start Show Logs"],
            "dependsOrder": "sequence"
        },
        { // needed to give a chance to vs code to update it's state
            "label": "Sleep", 
            "type": "shell",
            "command": "sleep 1"
        },
        {
            "label": "iOS: Terminate Current iOS App",
            "type": "shell",
            "command": "${workspaceFolder}/.vscode/terminate_current_running_app.sh"
        },
        {
            "label": "Start Show Logs",
            "command": "${command:launches.showIOSDebugLogs}",
            "group": "none"
        },
        {
            "label": "iOS: Start LLDB Debugger iOS App",
            "type": "shell",
            "command": "${command:launches.startIOSDebuging}",
            "dependsOrder": "sequence",
        },
        {
            "label": "iOS: Tests: Run All",
            "type": "shell",
            "command": "${workspaceFolder}/.vscode/test_app.sh",
            "args": [
                "ALL",
                "${input:selectDebbuger}"
            ],
            "group": {
                "kind": "test",
                "isDefault": false,
                "isTestCommand": true
            },
            "presentation": {
                "clear": true
            },
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "dependsOn":["iOS: Terminate Current iOS App", "iOS: Build Tests", "iOS: Start LLDB Debugger iOS App", "Start Show Logs"],
            "dependsOrder": "sequence"
        },
        {
            "label": "iOS: Tests: Run Current Class",
            "type": "shell",
            "command": "${workspaceFolder}/.vscode/test_app.sh",
            "args": [
                "CLASS",
                "CURRENTLY_SELECTED",
                "${input:selectDebbuger}"
            ],
            "group": {
                "kind": "test",
                "isDefault": false,
                "isTestCommand": true
            },
            "presentation": {
                "clear": true
            },
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "dependsOn":["iOS: Terminate Current iOS App", "iOS: Build Tests: Current File", "iOS: Start LLDB Debugger iOS App", "Start Show Logs"],
            "dependsOrder": "sequence"
        },
        {
            "label": "iOS: Generate xCode Server",
            "type": "shell",
            "command": "${workspaceFolder}/.vscode/build_autocomplete.sh",
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "dependsOn":["iOS: Validate Enviroment"]
        },
        {
            "label": "iOS: Bind Autocomplete",
            "type": "shell",
            "command": ".vscode/restart_lsp_swift.sh",
            "dependsOn": [
                "iOS: Generate xCode Server"
            ]
        },
        {
            "label": "iOS: Select Destination Device",
            "type": "shell",
            "command": ".vscode/update_enviroment.sh",
            "args": [
                "-destinationDevice",
                "${input:myDestinationDevice}"
            ],
            "problemMatcher": [], 
            "dependsOn":["iOS: Validate Enviroment"],
            "group": "none"
        },
        {
            "label": "iOS: Select Scheme",
            "type": "shell",
            "command": ".vscode/update_enviroment.sh",
            "args": [
                "-destinationScheme",
                "${input:myDestinationScheme}"
            ],
            "problemMatcher": [],
            "dependsOn":["iOS: Validate Enviroment"],
            "runOptions": {"runOn": "folderOpen"},
            "group": "none"
        },
        {
            "label": "iOS: Validate Enviroment",
            "type": "shell",
            "command": ".vscode/check_workspace.sh",
            "group": "none"
        },
        {
            "label": "Store VS Config",
            "type": "shell",
            "command": ".vscode/store_vs_config.sh",
            "args": [
                "${file}"
            ]
        }
    ],
    "inputs": [
        {
            "type": "pickString",
            "id": "selectDebbuger",
            "description": "Do you want to attach debugger?",
            "options": [
                {"label": "Debug", "value": "DEBUG_LLDB"},
                {"label": "Run", "value": "RUNNING"}
            ],
            "default": "Debug"
        },
        {
            "id": "myDestinationDevice",
            "type": "command",
            // first try to read from the disk or select again
            "command": "dynamic-inputs.read",
            "args": {
                "command": "bash",
                // a script which prints JSON array to stdout as the last line
                "args": [
                    "${workspaceFolder}/.vscode/populate_devices.sh"
                ],
                "envFile": "${workspaceFolder}/.vscode/.env",
                "cwd": "${workspaceFolder}",
                // memoize the selection for the future
                "var": "myDestinationDevice",
                // map options to values
                "unwrap": "$[*].value",
                "serializer": "plain",
                "quickPickOptions": {
                    "canPickMany": true, // should be false, but it's not working for some reason
                    //"ignoreFocusOut": true,
                    "placeHolder": "Please select Device",
                    "title": "Device"
                }
            }
        },
        {
            "id": "myDestinationScheme",
            "type": "command",
            // first try to read from the disk or select again
            "command": "dynamic-inputs.read",
            "args": {
                "command": "bash",
                // a script which prints JSON array to stdout as the last line
                "args": [
                    "${workspaceFolder}/.vscode/populate_schemes.sh"
                ],
                "envFile": "${workspaceFolder}/.vscode/.env",
                "cwd": "${workspaceFolder}",
                // memoize the selection for the future
                "var": "myDestinationScheme",
                // map options to values
                "unwrap": "$[*].value",
                "serializer": "plain",
                "quickPickOptions": {
                    "canPickMany": true, // should be false, but it's not working for some reason
                    //"ignoreFocusOut": true,
                    "placeHolder": "Please select Scheme",
                    "title": "Scheme"
                }
            }
        },
        {
            "id": "myTestsOfCurrentFile",
            "type": "command",
            // first try to read from the disk or select again
            "command": "dynamic-inputs.read",
            "args": {
                "command": "bash",
                // a script which prints JSON array to stdout as the last line
                "args": [
                    "${workspaceFolder}/.vscode/populate_tests_of_current_file.sh"
                ],
                "envFile": "${workspaceFolder}/.vscode/.env",
                "cwd": "${workspaceFolder}",
                // memoize the selection for the future
                "var": "myTestsOfCurrentFile",
                // map options to values
                "unwrap": "$[*].value",
                "serializer": "plain",
                "quickPickOptions": {
                    "canPickMany": true, // should be false, but it's not working for some reason
                    //"ignoreFocusOut": true,
                    "placeHolder": "Please select Tests",
                    "title": "Tests"
                }
            }
        } 
    ]
}